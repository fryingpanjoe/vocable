<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" charset="UTF-8" src="js/listHandler.js"></script>
<script type="text/javascript" charset="UTF-8">
var WORDS = new Array();

function addWord(lhs, rhs) {
    WORDS.push([lhs, rhs]);
}

function showRandomWord() {
    var index = Math.floor(Math.random() * WORDS.length)
    var both = WORDS[index];
    if (Math.random() < 0.5) {
        document.getElementById("test_translation").value = both[1];
        document.getElementById("test_word").focus();
        document.getElementById("test_word").value = "";
    } else {
        document.getElementById("test_word").value = both[0];
        document.getElementById("test_translation").focus();
        document.getElementById("test_translation").value = "";
    }
    document.getElementById("test_index").value = index;
}

function showWordList() {
    var list = document.getElementById("id_word_list_ul");
    while (list.firstChild) {
        list.removeChild(list.firstChild);
    }
    for (var i = 0; i < WORDS.length; i++) {
        var item = document.createElement("li");
        item.innerHTML = "<p>" + WORDS[i][0] + " <-> " + WORDS[i][1] + "</p>";
        list.appendChild(item)
    }
}

function handleStartTest() {
    document.getElementById("id_word_list").style.display = 'none';
    document.getElementById("id_show_words_button").style.display = 'block';
    document.getElementById("id_start_test").style.display = 'none';
    document.getElementById("id_test").style.display = 'block';
    document.getElementById("id_test_result").innerHTML = "";
    document.getElementById("id_test_result").style.display = 'block';
    document.getElementById("id_add_words").style.display = 'none';
    showRandomWord();
}

function handleStopTest() {
    document.getElementById("id_word_list").style.display = 'block';
    document.getElementById("id_show_words_button").style.display = 'none';
    document.getElementById("id_start_test").style.display = 'block';
    document.getElementById("id_test").style.display = 'none';
    document.getElementById("id_test_result").style.display = 'none';
    document.getElementById("id_add_words").style.display = 'block';
}

function handleShowWords() {
    document.getElementById("id_word_list").style.display = 'block';
    document.getElementById("id_show_words_button").style.display = 'none';
    document.getElementById("id_hide_words_button").style.display = 'block';
}

function handleHideWords() {
    document.getElementById("id_word_list").style.display = 'none';
    document.getElementById("id_show_words_button").style.display = 'block';
    document.getElementById("id_hide_words_button").style.display = 'none';
}

function handleTestCheck() {
    var word = document.getElementById("test_word").value.trim().toLowerCase();
    var translation = document.getElementById("test_translation").value.trim().toLowerCase();
    var index = document.getElementById("test_index").value;
    if (word != WORDS[index][0].toLowerCase()) {
        document.getElementById("id_test_result").innerHTML = "Fel!";
        return;
    }
    if (translation != WORDS[index][1].toLowerCase()) {
        document.getElementById("id_test_result").innerHTML = "Fel!";
        return;
    }
    document.getElementById("id_test_result").innerHTML = "Rätt!";
    showRandomWord();
}

function handleTestSkip() {
    showRandomWord();
}

function onLoad() {
    document.getElementById("id_show_words_button").style.display = 'none';

    document.getElementById("id_test").style.display = 'none';
    document.getElementById("id_test_result").style.display = 'none';

    document.getElementById("id_add_word_form").onsubmit = function(e) {
        e.preventDefault();
        if(this.word.value != '' && this.translation.value != ''){
            addWord(this.word.value.trim(), this.translation.value.trim());
            showWordList();

            
            document.getElementById("id_add_word_form").reset();
            document.getElementsByName("word")[0].focus();
        }
    }
    
    document.getElementsByName("word")[0].focus();
    
}
</script>
</head>
<body onLoad="onLoad()">
    <h1>Krimilingo</h1>

    <div id="id_input_mode">
        <div id="id_add_words">
            <h2>Lägg till:</h2>
            <form id="id_add_word_form">
                <p>Fråga: <input type="text" name="word"> Svar: <input type="text" name="translation">
                <input type="submit" value="Add word"></p>
            </form>
        </div>

        <div id="id_word_list">
            <h2>Frågelista</h2>
            <ul id="id_word_list_ul"></ul>
        </div>
        <div id="id_show_words_button">
            <input type="submit" value="Visa frågor" onClick="handleShowWords()">
        </div>
        <div id="id_hide_words_button">
            <input type="submit" value="Dölj frågor" onClick="handleHideWords()">
        </div>
    </div>

    <div id="id_start_test">
        <h2>Börja quiz</h2>
        <input type="submit" value="Starta quiz" onClick="handleStartTest()">
    </div>
    <div id="id_test">
        <table>
            <tr>
                <td><input type="text" name="test_word" id="test_word"></td>
                <td><input type="text" name="test_translation" id="test_translation"></td>
            </tr>
        </table>
        <input type="hidden" name="test_index" id="test_index">
        <input type="submit" value="Check" onClick="handleTestCheck()">
        <input type="submit" value="Skip" onClick="handleTestSkip()">
        <input type="submit" value="Stop test" onClick="handleStopTest()">
        <h3 id="id_test_result"></h3>
    </div>
</body>
</html>
