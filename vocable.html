<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" charset="UTF-8">
var WORDS = new Array();

function addWord(lhs, rhs) {
    WORDS.push([lhs, rhs]);
}

function exportWords(){
    var output= '';
    for(var i = 0; i < WORDS.length; i++){
        output += WORDS[i][0]+':'+WORDS[i][1]+"\n";
    }
    document.getElementById("id_import_textarea").value = output;
}

function importWords(){
    var temp = document.getElementById("id_import_textarea").value;
    var rows = temp.split("\n");

    var result = new Array();
    for(var i = 0; i < rows.length; i++){
        var cols = rows[i].trim().split(':');
        if(cols[0] != undefined && cols[1] != undefined){
            result.push(cols);
        }
    }
    WORDS = result;
    showWordList();
}

function showRandomWord() {
    var index = Math.floor(Math.random() * WORDS.length)
    var both = WORDS[index];

    var question = both[0];
    var solution = both[1];
    if (Math.random() < 0.5) {
        question = both[1];
        solution = both[0];
    }
    document.getElementById('id_question').innerHTML = question;
    document.getElementById('test_solution').value = solution;
    document.getElementById('test_answer').focus();
    document.getElementById('test_answer').value = "";    
    
    document.getElementById("test_index").value = index;
}

function showWordList() {
    var list = document.getElementById("id_word_list_ul");
    while (list.firstChild) {
        list.removeChild(list.firstChild);
    }
    for (var i = 0; i < WORDS.length; i++) {
        var item = document.createElement("li");
        item.innerHTML = "<p>" + WORDS[i][0] + " <-> " + WORDS[i][1] + "</p>";
        list.appendChild(item)
    }
}

function handleStartTest() {
    document.getElementById("id_word_list").style.display = 'none';
    document.getElementById("id_hide_words_button").style.display = 'none';
    document.getElementById("id_show_words_button").style.display = 'block';
    document.getElementById("id_start_test").style.display = 'none';
    document.getElementById("id_test").style.display = 'block';
    document.getElementById("id_test_result").innerHTML = "";
    document.getElementById("id_test_result").style.display = 'block';
    document.getElementById("id_add_words").style.display = 'none';
    showRandomWord();
}

function handleStopTest() {
    document.getElementById("id_word_list").style.display = 'block';
    document.getElementById("id_show_words_button").style.display = 'none';
    document.getElementById("id_start_test").style.display = 'block';
    document.getElementById("id_test").style.display = 'none';
    document.getElementById("id_test_result").style.display = 'none';
    document.getElementById("id_add_words").style.display = 'block';
    document.getElementsByName("word")[0].focus();
}

function handleShowWords() {
    document.getElementById("id_word_list").style.display = 'block';
    document.getElementById("id_show_words_button").style.display = 'none';
    document.getElementById("id_hide_words_button").style.display = 'block';
}

function handleHideWords() {
    document.getElementById("id_word_list").style.display = 'none';
    document.getElementById("id_show_words_button").style.display = 'block';
    document.getElementById("id_hide_words_button").style.display = 'none';
}

function handleTestCheck() {
    var answer = document.getElementById("test_answer").value.trim().toLowerCase();
    var solution = document.getElementById("test_solution").value.trim().toLowerCase();
    var index = document.getElementById("test_index").value;
    if (answer != solution) {
        document.getElementById("id_test_result").innerHTML = "Fel!";
        document.getElementById("test_answer").value = '';
        return;
    }
    document.getElementById("id_test_result").innerHTML = "Rätt!";
    showRandomWord();
}

function handleTestSkip() {
    showRandomWord();
}

function onLoad() {
    document.getElementById("id_show_words_button").style.display = 'none';

    document.getElementById("id_test").style.display = 'none';
    document.getElementById("id_test_result").style.display = 'none';

    document.getElementById("id_add_word_form").onsubmit = function(e) {
        e.preventDefault();
        if(this.word.value != '' && this.translation.value != ''){
            addWord(this.word.value.trim(), this.translation.value.trim());
            showWordList();

            document.getElementById("id_add_word_form").reset();
            document.getElementsByName("word")[0].focus();
        }
    }

    document.getElementById("id_test_form").onsubmit = function(e) {
        e.preventDefault();
        handleTestCheck();
    }    
        
    document.getElementsByName("word")[0].focus();
    
}
</script>
</head>
<body onLoad="onLoad()">
    <h1>Krimilingo</h1>

    <div id="id_input_mode">
        <div id="id_add_words">
            <h2>Lägg till:</h2>
            <form id="id_add_word_form">
                <p>Fråga: <input type="text" name="word"> Svar: <input type="text" name="translation">
                <input type="submit" value="Lägg till"></p>
            </form>
        </div>
    </div>
    
    <div id="id_import_export_mode" style="display:none">
        <form id="id_import_form">
            <textarea id="id_import_textarea" rows="12" cols="40"></textarea><br />
            <input type="button" value="Importera" onClick="importWords()"><input type="button" value="Exportera" onClick="exportWords()">
        </form>
    </div>
    
    <div id="id_words_list_div">
        <div id="id_word_list">
            <h2>Frågelista</h2>
            <ul id="id_word_list_ul"></ul>
        </div>
        <div id="id_show_words_button">
            <input type="submit" value="Visa frågor" onClick="handleShowWords()">
        </div>
        <div id="id_hide_words_button">
            <input type="submit" value="Dölj frågor" onClick="handleHideWords()">
        </div>        
    </div>
    

    <div id="id_start_test">
        <input type="submit" value="Starta quiz" onClick="handleStartTest()">
    </div>
    <div id="id_test">
        <form id="id_test_form">
            <span id="id_question"></span><br />
            <input type="text" name="test_answer" id="test_answer">
            <input type="hidden" name="test_solution" id="test_solution">
            <input type="submit" value="Rätta">
        </form>
        <input type="hidden" name="test_index" id="test_index">
        
        <input type="submit" value="Hoppa över" onClick="handleTestSkip()">
        <input type="submit" value="Avsluta test" onClick="handleStopTest()">
        <h3 id="id_test_result"></h3>
    </div>
</body>
</html>
